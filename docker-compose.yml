services:
  dev_service:
    build:
      context: .
      dockerfile: Dockerfile

    container_name: ${PROJECT_NAME}-dev
    
    environment:
      - DISPLAY=$CONTAINER_DISPLAY
      - QT_X11_NO_MITSHM=1
      - XAUTHORITY=/home/rosuser/.Xauthority
    
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    
    ports:
      - "${DEBUG_PORT:-5678}:5678"
    
    volumes:
      - ./src:/home/rosuser/repo/src
      - ${DATASET}:/home/rosuser/repo/dataset:rw
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      - ${HOME}/.Xauthority:/home/rosuser/.Xauthority:rw
    
    command: /bin/bash
    stdin_open: true
    tty: true
